/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * <h2><center>&copy; Copyright (c) 2021 STMicroelectronics.
 * All rights reserved.</center></h2>
 *
 * This software component is licensed by ST under BSD 3-Clause license,
 * the "License"; You may not use this file except in compliance with the
 * License. You may obtain a copy of the License at:
 *                        opensource.org/licenses/BSD-3-Clause
 *
 ******************************************************************************
 */


#include <stdint.h>
#include <stdint.h>
#include <stdio.h>
#include "gb_gpio.h"
#include "gb_i2c.h"
#include "gb_rcc.h"
#include "GB_UART.h"
#include "gb_t_delay.h"
#include "gb_ina219.h"
#include "stm32f1xx.h"
#include "gb_ssd1306.h"

//7 bit slave address is 0b0111100(0x3C)
static const unsigned char epd_bitmap_gettobyte_logo_128_64 []= {
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xf8, 0x01, 0xc0, 0x00, 0x00, 0xff, 0xfe, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xc0, 0x1f, 0xc0, 0x00, 0x00, 0xff, 0xfc, 0xcc, 0x00, 0x03, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0x00, 0xff, 0xc0, 0x00, 0x00, 0x5c, 0xcc, 0xcc, 0x00, 0x00, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xf8, 0x07, 0xff, 0xc0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x1f, 0xff, 0xff,
  0xff, 0xff, 0xe0, 0x3f, 0xff, 0xc0, 0x00, 0x00, 0xff, 0xff, 0xfc, 0xcf, 0x00, 0x07, 0xff, 0xff,
  0xff, 0xff, 0x80, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xfc, 0xfc, 0xcc, 0xff, 0xe0, 0x01, 0xff, 0xff,
  0xff, 0xff, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xf8, 0xcc, 0xcd, 0xc3, 0x30, 0x00, 0xff, 0xff,
  0xff, 0xfc, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xfc, 0xcc, 0xcc, 0xff, 0xff, 0x00, 0x3f, 0xff,
  0xff, 0xf0, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xfc, 0xcc, 0xcc, 0xe7, 0xf7, 0x00, 0x0f, 0xff,
  0xff, 0xe0, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xfc, 0xcc, 0xcc, 0xff, 0xff, 0xf0, 0x07, 0xff,
  0xff, 0xc0, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x1c, 0xcc, 0xcc, 0xe3, 0xe3, 0xf0, 0x03, 0xff,
  0xff, 0x00, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xfc, 0xcc, 0xcf, 0xff, 0xff, 0xfc, 0x00, 0xff,
  0xff, 0x00, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xff, 0xfc, 0xfc, 0xff, 0xff, 0x33, 0x00, 0xff,
  0xfc, 0x00, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x3f,
  0xfc, 0x00, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x0f, 0xcc, 0xcc, 0xc7, 0xff, 0x33, 0x00, 0x3f,
  0xf8, 0x00, 0x00, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x5c, 0xcc, 0xcc, 0xef, 0x73, 0x33, 0x00, 0x1f,
  0xf0, 0x00, 0x00, 0xff, 0xff, 0xc0, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x0f,
  0xf0, 0x00, 0x00, 0xff, 0xff, 0xc3, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x0f,
  0xe0, 0x00, 0x00, 0xff, 0xff, 0xcf, 0xff, 0xff, 0xff, 0xff, 0xcc, 0xce, 0xff, 0xf3, 0x30, 0x07,
  0xc0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0xde, 0x33, 0x33, 0x30, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x0f, 0xff, 0xff, 0xff, 0xff, 0x33, 0xf8, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x1f, 0xff, 0xce, 0x73, 0x33, 0x30, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0xff, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0x03,
  0x80, 0x00, 0x00, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0x3f, 0x01,
  0x00, 0x00, 0x00, 0xff, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xc7, 0x33, 0x33, 0x00,
  0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x33, 0x33, 0x00,
  0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x3f, 0xfc, 0x00, 0x00, 0x7f, 0xf3, 0x33, 0x3f, 0x00,
  0x00, 0x00, 0x00, 0xff, 0xf8, 0x00, 0x01, 0xc0, 0x03, 0xc0, 0x00, 0x3f, 0xff, 0xff, 0x3f, 0x00,
  0x80, 0x00, 0x00, 0xff, 0xf0, 0x00, 0x0f, 0x00, 0x00, 0x30, 0x00, 0x1f, 0xff, 0xff, 0xff, 0x01,
  0xc0, 0x00, 0x00, 0xff, 0xf0, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xc0, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0x33, 0x33, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0x33, 0x3a, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xc0, 0x00, 0xc0, 0x03, 0xff, 0xc0, 0x00, 0x07, 0xff, 0xf3, 0xfc, 0x03,
  0xc0, 0x00, 0x00, 0xff, 0xc0, 0x00, 0xc0, 0x01, 0x00, 0xf0, 0x00, 0x03, 0xff, 0x33, 0x38, 0x03,
  0xe0, 0x00, 0x00, 0xff, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x30, 0x00, 0x03, 0xff, 0xff, 0xfc, 0x07,
  0xf0, 0x00, 0x00, 0xff, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x30, 0x00, 0x03, 0xff, 0xff, 0xf8, 0x0f,
  0xf0, 0x00, 0x00, 0x7f, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x30, 0x00, 0x07, 0xff, 0xff, 0xf0, 0x0f,
  0xf8, 0x00, 0x00, 0x3f, 0xc0, 0x00, 0x30, 0x00, 0x00, 0x30, 0x00, 0x0f, 0xf3, 0x33, 0x30, 0x1f,
  0xfc, 0x00, 0x00, 0x3f, 0xe0, 0x00, 0x30, 0x00, 0x00, 0x30, 0x00, 0x0f, 0xff, 0xff, 0xc0, 0x3f,
  0xfc, 0x00, 0x00, 0x3f, 0xf0, 0x00, 0x0c, 0x00, 0x00, 0x30, 0x00, 0x0f, 0xff, 0x33, 0x00, 0x3f,
  0xff, 0x00, 0x00, 0x1f, 0xf0, 0x00, 0x03, 0xc0, 0x01, 0xc0, 0x00, 0x3f, 0xff, 0xf3, 0x00, 0xff,
  0xff, 0x00, 0x00, 0x0f, 0xfc, 0x00, 0x00, 0x7f, 0xff, 0x00, 0x00, 0x3f, 0xc7, 0x3f, 0x00, 0xff,
  0xff, 0xc0, 0x00, 0x07, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x38, 0x03, 0xff,
  0xff, 0xe0, 0x00, 0x03, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xf0, 0x07, 0xff,
  0xff, 0xf0, 0x00, 0x00, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xc0, 0x0f, 0xff,
  0xff, 0xfc, 0x00, 0x00, 0x7f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0x00, 0x3f, 0xff,
  0xff, 0xff, 0x00, 0x00, 0x1f, 0xfe, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xfe, 0x00, 0xff, 0xff,
  0xff, 0xff, 0x80, 0x00, 0x07, 0xff, 0xc0, 0x00, 0x00, 0x07, 0xff, 0xff, 0xf0, 0x01, 0xff, 0xff,
  0xff, 0xff, 0xe0, 0x00, 0x01, 0xff, 0xfe, 0x00, 0x00, 0xff, 0xff, 0xff, 0xc0, 0x07, 0xff, 0xff,
  0xff, 0xff, 0xf8, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x1f, 0xff, 0xff,
  0xff, 0xff, 0xff, 0x00, 0x00, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0x80, 0x03, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0xfc, 0xcc, 0xe0, 0x00, 0x1f, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0xff, 0xfc, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff,
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
};
/*
 * #if !defined(__SOFT_FP__) && defined(__ARM_FP)
 * #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
 * #endif
*/

uint8_t Character[8] =
{
		0b00000,
		0b11111,
		0b00100,
		0b01010,
		0b10001,
		0b00000,
		0b00000,
		0b00000
};
int main(void)
{
	system_clk();
	timer_initialise();
	RCC->APB2ENR |= RCC_APB2ENR_AFIOEN;
	AFIO->MAPR |= AFIO_MAPR_SWJ_CFG_JTAGDISABLE;
	//Gpio_output_pushpull_conf();

	GB_uart_init1();

	gb_i2c_master_init();
	ssd1306_init();
	ssd1306_clear(GB_SSD1306_COLOR_BLACK);
	ssd1306_update_data();

	//Animation 1
	ssd1306_draw_pixel(14,10,GB_SSD1306_COLOR_WHITE);
	ssd1306_update_data();
	delay_ms(1000);
	ssd1306_draw_pixel(14,15,GB_SSD1306_COLOR_WHITE);
	ssd1306_update_data();
	delay_ms(1000);
	ssd1306_draw_pixel(14,20,GB_SSD1306_COLOR_WHITE);
	ssd1306_update_data();
	delay_ms(2000);

	ssd1306_DrawLineV(0,63,0,1);
	ssd1306_update_data();
	delay_ms(1000);
	ssd1306_DrawLineH(0,127,0,1);
	ssd1306_update_data();
	delay_ms(1000);
	ssd1306_DrawLineH(0,127,63,1);
	ssd1306_update_data();
	delay_ms(1000);
	ssd1306_DrawLineV(0,63,127,1);
	ssd1306_update_data();
	delay_ms(1000);

	ssd1306_drawRectangle(26,14,40,18);
	ssd1306_update_data();
	delay_ms(1000);

	ssd1306_drawRectangleFill(26,14,29,15);
	ssd1306_update_data();
	delay_ms(1000);

	ssd1306_clear(GB_SSD1306_COLOR_BLACK);
	ssd1306_update_data();

//	ssd1306_GotoXY(3, 0);
//	ssd1306_print_string("Voltage value :", GB_SSD1306_COLOR_WHITE);
//	//ssd1306_update_data();
//
//
//	ssd1306_GotoXY(3, 20);
//	ssd1306_print_string("Current value :", GB_SSD1306_COLOR_WHITE);
//	ssd1306_update_data();

	float x = 00.00;
	//int ch = 10;
    /* Loop forever */
	while(1)
	{

		ssd1306_GotoXY(3, 0);
		ssd1306_print_string("Variable value :", GB_SSD1306_COLOR_WHITE);
		ssd1306_update_data();

		ssd1306_GotoXY(83, 0);
		ssd1306_float(x,GB_SSD1306_COLOR_WHITE);
		x++;
		ssd1306_update_data();
			ssd1306_update_data();
	}
}



/* Animation 1
 * 	ssd1306_draw_pixel(14,10,GB_SSD1306_COLOR_WHITE);
			ssd1306_update_data();
			delay_ms(1000);
			ssd1306_draw_pixel(14,15,GB_SSD1306_COLOR_WHITE);
			ssd1306_update_data();
			delay_ms(1000);
			ssd1306_draw_pixel(14,20,GB_SSD1306_COLOR_WHITE);
			ssd1306_update_data();
			delay_ms(2000);

	ssd1306_DrawLineV(0,63,0,1);
	ssd1306_update_data();
	delay_ms(1000);
	ssd1306_DrawLineH(0,127,0,1);
	 ssd1306_update_data();
    delay_ms(1000);
	ssd1306_DrawLineH(0,127,63,1);
	 ssd1306_update_data();
    delay_ms(1000);
	ssd1306_DrawLineV(0,63,127,1);
	 ssd1306_update_data();
	delay_ms(1000);

     ssd1306_drawRectangle(26,14,40,18);
	 ssd1306_update_data();
	 delay_ms(1000);

     ssd1306_drawRectangleFill(26,14,29,15);
     ssd1306_update_data();
	 delay_ms(1000);
 *
 */
